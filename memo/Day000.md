# Day000


## 오늘 한 일
- Toy_Project_00을 마무리하고 새로운 도약을 위해 Toy_Project_01 생성
- README.md 작성을 통한 목표 설정


## 내일 할 일 (오늘 밤에 해볼지도)
- ERD 초안 설계
- API 초안 설계
- 기본적인 패키지 구조 설계


### ERD 초안 설게 고려 사항
- 예약의 생명 주기 정의하기
    - 단순 구조 (Pending -> Confirmed)
        - 즉, 사용자가 점유하면 결제 승인이 날 때까지 점유
        - 장: 구현이 쉬워보임 / 정합성 보장이 어려울 것 같지 않음
        - 단: 사용자가 결제를 안하고 나간다면? 그냥 점유에 대한 기준 필요

    - 임시 점유 구조(Draft/Expired -> Reserved)
        - 임시 점유만 가능
        - 일정 시간 동안 예약이 되지 않으면 취소
        
- 동시성을 고려한 자원의 성격
    - 고유 자원
        - PK 하나만 막으면 끝 (낙관적 락)
    
    - 수량 자원
        - 선착순 100명
        - 어떻게 진짜로 딱 100개만 지급할까?

- 일단 고민 끝에 나온 결론
    - 쿠폰 / 좌석 예약 시스템 둘 다 만들어보자
    - 그리고 자원의 점유에는 만료 시간을 부여하자(쿠폰 제외)
    - 취소 시스템은 어떻게 구현할 것인가 고민 중...

- 근데 만료된 데이터를 어떻게 처리할까도 고민해야함
    - 스케줄러(Spring Task)가 1분마다 돌면서 만료된 행을 삭제/변경
    - 다음 사용가 조회할 때 if(expired_at < now) 조건을 체크해서 실시간으로 무효화
    - Redis의 TTL 기능을 활용해 데이터가 알아서 사라지게 함


### 기본적인 패키지 구조 설계
```text
com.zrp.toyproject01
├── global                  // [전역 공통]
│   ├── common              // (공통 응답 포맷: ApiResponse 등)
│   ├── config              // (설정: Security, Web, Swagger, Redis)
│   └── error               // (예외 핸들링: GlobalExceptionHandler, ErrorCode)
│
└── domain                  // [비즈니스 영역]
    ├── account             // [회원] 
    │   ├── api             // AccountController (회원가입, 로그인)
    │   ├── application     // AccountService
    │   ├── dao             // UserRepository
    │   ├── domain          // User (Entity)
    │   └── dto             // LoginRequest, SignupRequest
    │
    ├── seat                // [좌석 자원] (Only Resource)
    │   ├── api             // SeatController (좌석 조회)
    │   ├── application     // SeatService
    │   ├── dao             // SeatRepository
    │   ├── domain          // Seat (Entity - version 필드 포함)
    │   └── dto             // SeatResponse
    │
    ├── reservation         // [좌석 예약 행위] (Action: Seat Reservation)
    │   ├── api             // ReservationController (예약 요청, 취소)
    │   ├── application     // ReservationService (트랜잭션/동시성 핵심 로직)
    │   ├── dao             // ReservationRepository
    │   ├── domain          // Reservation (Entity - expired_at 포함)
    │   └── dto             // ReserveSeatRequest
    │
    └── coupon              // [쿠폰 자원 + 발급 행위] (Resource + Action)
        ├── api             // CouponController (쿠폰 조회, 발급 요청)
        ├── application     // CouponService (수량 차감 동시성 핵심 로직)
        ├── dao             // CouponRepository, IssuedCouponRepository
        ├── domain          // Coupon (Entity - 수량), IssuedCoupon (Entity - 발급내역)
        └── dto             // IssueCouponRequest
```

- powershell 명령어로 쉽게 만들기
    ```bash
    # 1. 패키지 루트로 이동
    cd src\main\java\com\zrp\toyproject01

    # 2. Global 패키지 생성
    mkdir global\config, global\error, global\common

    # 3. Domain 패키지 생성 (반복문)
    $domains = "account", "seat", "coupon", "reservation"
    $layers = "api", "application", "dao", "domain", "dto"

    foreach ($d in $domains) {
        foreach ($l in $layers) {
            New-Item -ItemType Directory -Path "domain\$d\$l" -Force
        }
    }
    ```


### 코딩 시작
- Step 1: Global 공통 클래스 (ApiResponse, ErrorCode,GlobalExceptionHandler)
- Step 2: Account 도메인 기초 (User Entity, UserRepository)
- Step 3: Seat & Reservation 도메인 (대망의 동시성 로직)


### 일단 오늘은 여기까지
- ApiResponse / ErrorCode / BusinessException / GlobalExceptionHandler 구현
- 근데 롬북도 안씀. 근데 이제 롬북을 사용할 것 같고
- 프로젝트의 방향성을 다시 한 번 정리해야하는 시간도 가져야할 것 같음
- UI 방향성이랑, 데이터 로직 방향성이랑, JWT 로그인, 그 외 프로젝트 구조를 확장성과 테스트, 로깅 등을 위한 방향성을 아직은 좀 더 고민해봐야할 듯
- 오늘은 여기까지 -2026.02.03 03:00-